#include "common.h"
#include <stdalign.h>
#include "EC_add_HW_ASM.h"
#include "montMul_HW_ASM.h"
#include "CoDesign.h"
#include "ecdsa_types.h"
#include "ecdsa.h"
#include "tests/testbench.h"

void test_montgomery_multiplication_hw() {
  alignas(128) uint32_t res[32];

  memset(res, 0, sizeof(res));

  alignas(128) uint32_t a[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa6406fa0, 0x53b70b21, 0x7cfe76c5, 0x99ba8b73, 0x83e65e9f, 0xdbb2359b, 0xe02744b5, 0x55bb2472, 0xab497843, 0x6521470d, 0x1eb3060a, 0x2ed06caf};
  alignas(128) uint32_t b[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xc079ee40, 0xd2afdb66, 0xe108c354, 0x80ba5847, 0x9aa08423, 0x1df7c26f, 0x59a67341, 0xafa40f30, 0xfe7de07a, 0xd3fbd0bb, 0x0387b2af, 0x00977f0e};
  //alignas(128) uint32_t res[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0551eb20, 0xcf1d6929, 0xf12e3720, 0x0b73ca5f, 0xbda44e34, 0x33c07d77, 0xb9bd2607, 0x27d8cd55, 0x65e463fc, 0x91d843ae, 0x4a81c428, 0x2f8583e9};

  xil_printf("Starting Montgomery Multiplication HW Test\n\r");
  START_TIMING
  montMul_HW_ASM(a, b, res);
  STOP_TIMING
  xil_printf("Montgomery Multiplication Result:\n\r");
  print_array_contents("result", res);
}

void test_ecdsa_add_hw() {
  alignas(128) EC_point_t P = {.X = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x5280b7f8, 0xba1a22a6, 0x6ae7420b, 0x39dd1383, 0x62b670c7, 0xd7c12ef4, 0xbc95beec, 0x8dddf19a, 0x21149710, 0x3c16868f, 0x2582b474, 0xa56bd556}, .Y = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa4872040, 0xa4ead924, 0x2fc88ed9, 0xc2d14f03, 0x98092607, 0x073a8e31, 0x37866ffc, 0xb9e8aa81, 0xe2b423f0, 0x9d5198a2, 0xfbd0769e, 0xc4b61898}, .Z = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xad19bc48, 0xe77aa4f0, 0xb4501309, 0xbee73a56, 0xc073ce56, 0x3fcff6a0, 0xbe6c6750, 0xa8ca12d7, 0x2ed55d97, 0x27f9c7ab, 0x8839a548, 0x85a6b24a}};
  alignas(128) EC_point_t Q = {.X = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x194fd5c8, 0xd4014aa5, 0x438ed0a6, 0x6f6dd014, 0xf6d05a7f, 0xc404589d, 0x5cbaa9b9, 0xa79a6d0c, 0xea8ec447, 0x4127e20b, 0x59e3311a, 0x8af6d320}, .Y = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xc7b32938, 0xdd80c053, 0x743120df, 0x69aba8bf, 0x1f4952ec, 0x2eb5bcba, 0xd9463f1b, 0xe9a1e5e9, 0xa8c566ca, 0xd3950ad4, 0xe0e8782a, 0x34546ce0}, .Z = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x428238d8, 0x94c89128, 0x4e1db066, 0x6cad2c53, 0xc1db6ace, 0x8a89059c, 0x85fd151a, 0xd05aef86, 0xd62229d6, 0xc260acc9, 0xe9c0e9be, 0x3d6fb541}};
  alignas(128) EC_point_t R;// = {.X = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa17e4e28, 0x615b3a2d, 0xf68a4a43, 0xf4b48f6c, 0x062a0b36, 0xcabcfa9c, 0xab1a68d9, 0x50f134a9, 0xaccacf58, 0x6486eef2, 0x593c9032, 0x791ee865}, .Y = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0105a858, 0xa8090c90, 0xb06f5534, 0x3da50067, 0x9b55f278, 0x913f463d, 0x504a2505, 0x2e26ade2, 0x273d64fe, 0x1e56cbac, 0x775ff647, 0x4f9fc4d9}, .Z = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xab413560, 0xf54b7849, 0xde22e7f0, 0x85ab34f3, 0xe78fe1bd, 0x1852a68f, 0x8f63b0ec, 0x22c1d8e0, 0xedc95f35, 0x0993d48d, 0xc4e50a68, 0x7298909b}};

  memset(&R, 0, sizeof(EC_point_t));
  
  START_TIMING
  EC_add_HW(&P, &Q, &R);
  STOP_TIMING
  xil_printf("EC Point Addition Result:\n\r");
  print_array_contents("R.X", R.X);
  print_array_contents("R.Y", R.Y);
  print_array_contents("R.Z", R.Z);

  EC_add_HW(&P, &Q, &R);;
  xil_printf("EC Point Addition Result 2nd time:\n\r");
  print_array_contents("R.X", R.X);
  print_array_contents("R.Y", R.Y);
  print_array_contents("R.Z", R.Z);
}

void test_ecdsa_verification_hw() {
  alignas(128) uint32_t message[32]   = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0259f288, 0xff51387e, 0x7ec8d3fe, 0x5a65e59f, 0xe3d2fe18, 0xb37f6b53, 0xe9d354f2, 0x85c0ae96, 0x00000002, 0x00000000, 0x00000000, 0x00000000};       
                                                                                       
  // Signature K and s         
  alignas(128) uint32_t K_X[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xac378fd0, 0x28f98829, 0x5140aec3, 0xb5048e19, 0x07124bea, 0x5e8bfc74, 0x702f5d97, 0xc7fe1c4c, 0xef0c6e29, 0x0660e9b5, 0x2745d20c, 0x11ccb5fa};          
  alignas(128) uint32_t K_Y[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xda6bdf90, 0x23a8a482, 0x06c27b16, 0x0cbb8284, 0xdc623e93, 0x5c5f19e4, 0x5faec492, 0xc6fa839c, 0x4ef18f66, 0xd34e3f31, 0xc3130c3c, 0x804bf30c};          
  alignas(128) uint32_t K_Z[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x5c96d600, 0x852f4d15, 0x67b09ed2, 0x97f69beb, 0x5bedb31e, 0xb2aa3a04, 0x5c906880, 0xd1c7e5e1, 0xde3192a5, 0x16e907e1, 0x919f135e, 0xc79e31bc};          
  alignas(128) uint32_t s[32]         = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x24a64420, 0xa186a2ed, 0xf7b9cb60, 0xf4670b41, 0xf618eb69, 0x6c5c2aa9, 0x9cc3d97c, 0xb7600dd3, 0x00000002, 0x00000000, 0x00000000, 0x00000000};             
  alignas(128) EC_point_t K;
  memcpy(K.X, K_X, sizeof(K_X));
  memcpy(K.Y, K_Y, sizeof(K_Y));
  memcpy(K.Z, K_Z, sizeof(K_Z));
  alignas(128) signature_t signature;
  memcpy(signature.K.X, K_X, sizeof(K_X));
  memcpy(signature.K.Y, K_Y, sizeof(K_Y));
  memcpy(signature.K.Z, K_Z, sizeof(K_Z));
  memcpy(signature.s, s, sizeof(s));

  // Public key                                                                          
  alignas(128) uint32_t Public_X[32]  = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa2f5e608, 0x82870fe2, 0xcf727478, 0x7a1ec66e, 0xf3214f63, 0x0f4102a2, 0xe45624a8, 0x46e21127, 0xacd05523, 0xedc3c7cb, 0x6bcb560b, 0x46590dc7}; 
  alignas(128) uint32_t Public_Y[32]  = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x336e9f70, 0x02b3cc1f, 0xba951023, 0xaf18db90, 0x6620e457, 0x25723d1d, 0x878b8a4f, 0x256e6329, 0x421c5515, 0x6d38af9e, 0xb9c87b19, 0xae6017a6}; 
  alignas(128) uint32_t Public_Z[32]  = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x4710c2b8, 0xb58c1d41, 0x9a3b49b2, 0x149961fc, 0xe6f48603, 0x830564e1, 0x50abff30, 0xc24b9cda, 0x3c814ab1, 0xfd98b650, 0x5f994238, 0x832a85af}; 
  alignas(128) EC_point_t PublicKey;
  memcpy(PublicKey.X, Public_X, sizeof(Public_X));
  memcpy(PublicKey.Y, Public_Y, sizeof(Public_Y));
  memcpy(PublicKey.Z, Public_Z, sizeof(Public_Z));
                                                                                        
  //START POINT ON CURVE                                                                                       
  alignas(128) uint32_t G_X[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xd91635d8, 0xd9d78056, 0xcbd0d77f, 0x62af41ff, 0xb8dd62c3, 0x0a71d1f8, 0xbba5c82d, 0x1b44627c, 0x7d4d607e, 0x34ab1c62, 0x8cbebca1, 0xbf8e9d39};          
  alignas(128) uint32_t G_Y[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x362f3f08, 0x6551194a, 0x14445720, 0x81e63a25, 0x60259f6e, 0x06d8c659, 0xae8057b0, 0xe7af04ae, 0xa0ec5727, 0x04f1876b, 0x1d55078d, 0x459fa40f};          
  alignas(128) uint32_t G_Z[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000008, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};          
  alignas(128) EC_point_t G;
  memcpy(G.X, G_X, sizeof(G_X));
  memcpy(G.Y, G_Y, sizeof(G_Y));
  memcpy(G.Z, G_Z, sizeof(G_Z));
                                                                                        
  alignas(128) uint32_t K_X_Modn[32]  = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x50c7a4a8, 0xa9765f0a, 0xd7296da4, 0x633fb2a5, 0x7e2e7fd7, 0x2176a8f6, 0x9082f474, 0xbc8e9338, 0x00000002, 0x00000000, 0x00000000, 0x00000000};             

  xil_printf("Starting ECDSA Signature Verification...\n\r");
  START_TIMING
  uint32_t signature_valid = verify_ecdsa(message, &signature, &PublicKey, &G, K_X_Modn);
  STOP_TIMING
  if (signature_valid) {
    xil_printf("Signature is VALID.\n\r");
  } else {
    xil_printf("Signature is INVALID.\n\r");
  }

  xil_printf("ECDSA Signature Verification Completed.\n\r");

// OUTPUT VALUES final                                                                 
  alignas(128) uint32_t C_X[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xfcd29530, 0x21dfe4bc, 0x641adae3, 0x2de992d7, 0xdec73d0c, 0x404570f6, 0xd8904a92, 0xbb78f902, 0x3f66edfa, 0x20882ead, 0xc48ac2cf, 0x7ded7afc};          
  alignas(128) uint32_t C_Y[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1409da08, 0x2222d474, 0x19bbb575, 0xf2320fda, 0xc30fe0e4, 0x3ca41db5, 0x661af613, 0x4ebf6b87, 0xef080012, 0x7e3091de, 0xce227964, 0x1d6ee2d2};          
  alignas(128) uint32_t C_Z[32]       = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x346d4ce8, 0xb756bf9f, 0x4637bad1, 0x1897835d, 0x5af2c5f4, 0x9e6afa9d, 0x45745352, 0xdd95bd38, 0x714bc4f4, 0x17d0b119, 0xcc5368b0, 0x4507e81e};          
  alignas(128) uint32_t C_Prime_X[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa36017f8, 0xd563a6e4, 0xfed10aca, 0x79052aa6, 0x2d30e816, 0xf27cf990, 0x617eb804, 0x932acb6b, 0xfec9ded2, 0x5b623160, 0xde3bc5a8, 0xcc6bcbb7};    
  alignas(128) uint32_t C_Prime_Y[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x03ad9338, 0xcf4318ef, 0x20108c13, 0x2391ef87, 0x7e428d01, 0x4aca000a, 0x7b45983c, 0xc52ac1c0, 0xeb9f482f, 0x922925ef, 0xe6a86697, 0x6f081340};    
  alignas(128) uint32_t C_Prime_Z[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x54462e30, 0xc70f080e, 0x4530d320, 0x766ca27c, 0x541bcaac, 0xdf719552, 0x755723f6, 0xb16f20a7, 0x3f4696a6, 0x3f332a87, 0x08ea0094, 0x0bde3992};    
}

void test_ecdsa_multiplication() {
  alignas(128) uint32_t K_X_Modn[32]  = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x50c7a4a8, 0xa9765f0a, 0xd7296da4, 0x633fb2a5, 0x7e2e7fd7, 0x2176a8f6, 0x9082f474, 0xbc8e9338, 0x00000002, 0x00000000, 0x00000000, 0x00000000};

  alignas(128) uint32_t s1[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x50c7a4a8, 0xa9765f0a, 0xd7296da4, 0x633fb2a5, 0x7e2e7fd7, 0x2176a8f6, 0x9082f474, 0xbc8e9338, 0x00000002, 0x00000000, 0x00000000, 0x00000000};
  alignas(128) EC_point_t Point = {.X = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xa2f5e608, 0x82870fe2, 0xcf727478, 0x7a1ec66e, 0xf3214f63, 0x0f4102a2, 0xe45624a8, 0x46e21127, 0xacd05523, 0xedc3c7cb, 0x6bcb560b, 0x46590dc7}, .Y = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x336e9f70, 0x02b3cc1f, 0xba951023, 0xaf18db90, 0x6620e457, 0x25723d1d, 0x878b8a4f, 0x256e6329, 0x421c5515, 0x6d38af9e, 0xb9c87b19, 0xae6017a6}, .Z = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x4710c2b8, 0xb58c1d41, 0x9a3b49b2, 0x149961fc, 0xe6f48603, 0x830564e1, 0x50abff30, 0xc24b9cda, 0x3c814ab1, 0xfd98b650, 0x5f994238, 0x832a85af}};
  alignas(128) uint32_t res_X[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x458408e8, 0xca4f6cdd, 0xa5cb3093, 0x0708c644, 0x8729050f, 0x01b44566, 0x9fe0c3ab, 0x88f1eb0d, 0xe1de0711, 0xf44ef542, 0xf83ecc43, 0x0ceb91ea};
  alignas(128) uint32_t res_Y[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x06b7a030, 0xb1c33bc5, 0x480f7903, 0x658cd348, 0xd8699df6, 0xcff4abe3, 0x5fc0a88f, 0x19565c2a, 0x297de04a, 0x2cd88d52, 0x335eb0bf, 0x0fda7415};
  alignas(128) uint32_t res_Z[32] = {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x97f5c8c8, 0xeb8e04bb, 0xe89c04b4, 0x4825ce70, 0xae5a7cb4, 0x762c5370, 0x846f48e9, 0x7c1ea3a6, 0xce4a4189, 0x567f5999, 0x30d04aa0, 0x3317ab7e};

  alignas(128) EC_point_t R;
  memset(&R, 0, sizeof(EC_point_t));

  EC_mult(&Point, s1, &R);
  xil_printf("ECDSA Multiplication Result:\n\r");
  print_array_contents("R.X", R.X);
  print_array_contents("R.Y", R.Y);
  print_array_contents("R.Z", R.Z);
}

int main() {

  init_platform();
  init_performance_counters(0);
  
  xil_printf("Starting CoDesign Testbench\n\r");

  enum test_mode {MONTGOMERY_MUL_HW=1, ECDSA_ADD_HW=2, ECDSA_VERIFICATION_HW=3, ECDSA_VERIFICATION_MANY=4, ECDSA_MULTIPLICATION=5, ECDSA_VERIFY=6};
  enum test_mode test_mode = ECDSA_VERIFICATION_HW;
  
  START_TIMING
  switch(test_mode) {
    case MONTGOMERY_MUL_HW:
      test_montgomery_multiplication_hw();
      break;
    case ECDSA_ADD_HW:
      test_ecdsa_add_hw();
      break;
    case ECDSA_VERIFICATION_HW:
      test_ecdsa_verification_hw();
      break;
    case ECDSA_VERIFICATION_MANY:
      test_ecdsa_verification_many();
      break;
    case ECDSA_MULTIPLICATION:
      test_ecdsa_multiplication();
      break;
    default:
      xil_printf("Invalid test mode selected.\n\r");
      break;
  }
  STOP_TIMING
  xil_printf("CoDesign Testbench Completed\n\r");

  cleanup_platform();

  return 0;
}


